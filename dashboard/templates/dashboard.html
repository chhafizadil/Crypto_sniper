<!DOCTYPE html>
<html>
<head>
    <title>CryptoSniper Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        async function updateTable() {
            const ws = new WebSocket("ws://" + window.location.host + "/ws");
            ws.onmessage = function(event) {
                const signals = JSON.parse(event.data);
                const tableBody = document.querySelector("tbody");
                tableBody.innerHTML = "";
                signals.forEach(signal => {
                    const row = document.createElement("tr");
                    row.className = signal.trade_type === "Scalping" ? "scalping" : "normal";
                    row.innerHTML = `
                        <td>${signal.symbol}</td>
                        <td>${signal.price.toFixed(4)}</td>
                        <td>${signal.direction}</td>
                        <td>${signal.tp1.toFixed(4)} (${signal.tp1_possibility.toFixed(2)}%)</td>
                        <td>${signal.tp2.toFixed(4)} (${signal.tp2_possibility.toFixed(2)}%)</td>
                        <td>${signal.tp3.toFixed(4)} (${signal.tp3_possibility.toFixed(2)}%)</td>
                        <td>${signal.sl.toFixed(4)}</td>
                        <td>${signal.confidence.toFixed(2)}%</td>
                        <td>${signal.trade_type}</td>
                        <td>${signal.indicators_used}</td>
                        <td>${signal.backtest_result.toFixed(2)}%</td>
                        <td>${signal.volume.toFixed(2)}</td>
                        <td>${signal.timestamp}</td>
                    `;
                    tableBody.appendChild(row);
                });
            };
        }
        window.onload = updateTable;
    </script>
</head>
<body>
    <h1>CryptoSniper Trading Signals</h1>
    <table border="1">
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Price</th>
                <th>Direction</th>
                <th>TP1 (%)</th>
                <th>TP2 (%)</th>
                <th>TP3 (%)</th>
                <th>SL</th>
                <th>Confidence</th>
                <th>Trade Type</th>
                <th>Indicators</th>
                <th>Backtest</th>
                <th>Volume</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody>
            {% for signal in signals %}
            <tr class="{{ 'scalping' if signal.trade_type == 'Scalping' else 'normal' }}">
                <td>{{ signal.symbol }}</td>
                <td>{{ signal.price|floatformat(4) }}</td>
                <td>{{ signal.direction }}</td>
                <td>{{ signal.tp1|floatformat(4) }} ({{ signal.tp1_possibility|floatformat(2) }}%)</td>
                <td>{{ signal.tp2|floatformat(4) }} ({{ signal.tp2_possibility|floatformat(2) }}%)</td>
                <td>{{ signal.tp3|floatformat(4) }} ({{ signal.tp3_possibility|floatformat(2) }}%)</td>
                <td>{{ signal.sl|floatformat(4) }}</td>
                <td>{{ signal.confidence|floatformat(2) }}%</td>
                <td>{{ signal.trade_type }}</td>
                <td>{{ signal.indicators_used }}</td>
                <td>{{ signal.backtest_result|floatformat(2) }}%</td>
                <td>{{ signal.volume|floatformat(2) }}</td>
                <td>{{ signal.timestamp }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
